---
title: Model I/O
tags:
  - AI
  - AIåº”ç”¨å¼€å‘
  - llm
  - å¤§æ¨¡å‹
  - å¤§æ¨¡å‹åº”ç”¨å¼€å‘
  - LangChain
  - Model I/O
---

# Model I/O

LangChainæ¡†æ¶æ˜¯ç”¨äºå¼€å‘å¤§æ¨¡å‹åº”ç”¨çš„ï¼Œå¯¹äºä»»ä½•å¤§æ¨¡å‹åº”ç”¨è€Œè¨€ï¼ŒModelï¼ˆæ¨¡å‹ï¼‰éƒ½æ˜¯æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ã€‚ LangChain æä¾›äº†ä¸ä»»ä½• Model è¿›è¡Œäº¤äº’çš„çš„æ„å»ºæ¨¡å—ï¼Œ å³ Model I/Oã€‚LangChain çš„ Model I/O æ¨¡å—æ˜¯ä¸è¿™äº›è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰è¿›è¡Œäº¤äº’çš„æ ¸å¿ƒç»„ä»¶ï¼Œå®ƒåŒ…æ‹¬æ¨¡å‹è¾“å…¥ï¼ˆPromptsï¼‰ã€æ¨¡å‹è¾“å‡ºï¼ˆOutput Parsersï¼‰å’Œæ¨¡å‹æœ¬èº«ï¼ˆLanguage Modelsï¼‰

## 1. Model I/Oçš„æ ¸å¿ƒæ¦‚å¿µ

åœ¨ LangChain çš„ Model I/O æ¨¡å—è®¾è®¡ä¸­ï¼Œä¸»è¦ç”±ä¸‰ä¸ªå…³é”®ç»„ä»¶æ„æˆï¼šPrompt Templateï¼ˆå¯¹åº”å›¾ä¸­çš„ Formatï¼‰ã€Language Modelsï¼ˆå¯¹åº” Predictï¼‰ã€ä»¥åŠ Output Parserï¼ˆå¯¹åº” Parseï¼‰ã€‚

* **Format**ï¼šå¯¹åº” Prompt Templateï¼Œé€šè¿‡é¢„è®¾æ¨¡æ¿å¯¹å¤§æ¨¡å‹è¾“å…¥è¿›è¡Œç»“æ„åŒ–ç»„ç»‡å’Œç®¡ç†

* **Predict**ï¼šä»£è¡¨ Model éƒ¨åˆ†ï¼Œè´Ÿè´£é€šè¿‡ç»Ÿä¸€æ¥å£æ¥å…¥å’Œè°ƒç”¨ä¸åŒçš„å¤§è¯­è¨€æ¨¡å‹

* **Parse**ï¼šå³ Output Parserï¼Œç”¨äºä»æ¨¡å‹è¾“å‡ºä¸­æå–æ‰€éœ€ä¿¡æ¯ï¼Œå¹¶æ ¹æ®æ—¢å®šæ ¼å¼è¿›è¡Œè§„èŒƒåŒ–å¤„ç†åè¾“å‡º

![](../../../assets/img/AIè¿›é˜¶ä¹‹è·¯/å¤§æ¨¡å‹åº”ç”¨å¼€å‘/LangChainä»å…¥é—¨åˆ°ç²¾é€š/Model-IO/langchain-model1.png)

æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šè®²ä¸¤ç§æ¨¡å‹ç±»å‹ï¼Œä¸€ç§æ˜¯åŸºç¡€çš„Language Modelï¼ˆLLMï¼‰ï¼Œå¦ä¸€ç§æ˜¯ä¸“æ³¨å¯¹è¯çš„ Chat LLMã€‚ä¹‹åè¿˜ä¼šä»‹ç»æ€ä¹ˆç”¨ Prompt Templates æ¥æ•´ç†æ¨¡å‹çš„è¾“å…¥å†…å®¹ï¼Œä»¥åŠæ€ä¹ˆç”¨ Output Parser æ¥å¤„ç†æ¨¡å‹çš„è¾“å‡ºç»“æœï¼Œè®©å®ƒä»¬æ›´æ˜“è¯»ã€æ›´ç¬¦åˆé¢„æœŸæ ¼å¼ã€‚

> **åŸºç¡€ LLMï¼ˆBase LLMï¼‰**
>
> åœ¨ LangChain ä¸­ï¼ŒLLM é€šå¸¸æŒ‡çš„æ˜¯ä¼ ç»Ÿçš„æ–‡æœ¬è¡¥å…¨æ¨¡å‹ï¼ˆText Completionï¼‰ã€‚è¿™ç±»æ¨¡å‹é€šè¿‡å°è£…çš„ API æ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„æç¤ºè¯ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¿”å›å¯¹åº”çš„æ–‡æœ¬è¡¥å…¨ç»“æœï¼Œè¾“å‡ºåŒæ ·æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚
>
> **å¯¹è¯å¼ LLMï¼ˆChat LLMï¼‰**
>
> Chat LLM è™½ç„¶é€šå¸¸æ„å»ºåœ¨ Base LLM ä¹‹ä¸Šï¼Œä½†é’ˆå¯¹å¤šè½®å¯¹è¯åœºæ™¯åšäº†ä¸“é—¨ä¼˜åŒ–ã€‚å®ƒä»¬é‡‡ç”¨ä¸åŒäºåŸºç¡€æ¨¡å‹çš„æ¥å£å½¢å¼ï¼Œä»¥èŠå¤©æ¶ˆæ¯çš„åˆ—è¡¨ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¿”å›ç»“æ„åŒ–çš„å“åº”ï¼ˆResponse ç±»å‹ï¼‰ï¼Œè€Œä¸ä»…ä»…æ˜¯ç®€å•çš„å­—ç¬¦ä¸²æ–‡æœ¬ã€‚

## 2. PromptTemplate

### 2.1 Prompt

Prompt æ˜¯ç”¨æˆ·è¾“å…¥ç»™å¤§è¯­è¨€æ¨¡å‹çš„ä¸€ç³»åˆ—æŒ‡ä»¤æˆ–æç¤ºï¼Œç”¨äºé™å®šä»»åŠ¡èŒƒå›´ã€æä¾›ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå¹¶å¼•å¯¼æ¨¡å‹ç”Ÿæˆç¬¦åˆé¢„æœŸçš„è¯­è¨€è¾“å‡ºï¼Œå¦‚é—®ç­”ã€å¯¹è¯ã€æ–‡æœ¬ç”Ÿæˆç­‰

### 2.2 prompt templates

Prompt æ¨¡æ¿æ˜¯ä¸€ç§é¢„å®šä¹‰çš„ç»“æ„ï¼Œç”¨äºæ„å»ºï¼ˆæ ¼å¼åŒ–ï¼‰å‘é€ç»™å¤§è¯­è¨€æ¨¡å‹çš„ promptã€‚å®ƒé€šå¸¸åŒ…å«æŒ‡ä»¤è¯´æ˜ã€few-shot ç¤ºä¾‹ã€ä»»åŠ¡ç›¸å…³çš„ä¸Šä¸‹æ–‡å’Œå…·ä½“é—®é¢˜ç­‰å†…å®¹ã€‚ç®€å•ç†è§£Prompt æ¨¡æ¿å°±åƒä¸€ä¸ªäº‹å…ˆè®¾å®šå¥½çš„â€œé—®é¢˜æ ¼å¼â€ï¼Œå¯ä»¥å¸®æˆ‘ä»¬å¿«é€Ÿç”Ÿæˆæ ‡å‡†åŒ–çš„æ¨¡å‹æŒ‡ä»¤ã€‚LangChain æä¾›äº†ä¸€äº›ä¸å…·ä½“æ¨¡å‹æ— å…³çš„é€šç”¨ prompt æ¨¡æ¿ï¼Œè¿™äº›æ¨¡æ¿å¯ä»¥åœ¨ä¸åŒçš„ LLM ä¸Šå¤ç”¨ï¼Œæé«˜å¼€å‘æ•ˆç‡å’Œé€‚é…çµæ´»æ€§ã€‚

### 2.3 PromptTemplateï¼ˆå­—ç¬¦ä¸²æç¤ºæ¨¡æ¿ï¼‰

PromptTemplateä¸»è¦ç”¨äºåˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²promptï¼Œå…¶å®å®ƒå°±æ˜¯ç›¸å½“äºçš„Python str.format ï¼Œç”¨æ¥æ ¼å¼åŒ–æˆ‘ä»¬çš„è¾“å…¥ã€‚å®ƒæ”¯æŒä»»æ„æ•°é‡çš„å˜é‡ï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰æ²¡æœ‰å˜é‡

#### 2.3.1 æŒ‡å®šå‚æ•°

```python
from langchain.prompts import PromptTemplate

prompt_template = PromptTemplate.from_template(
    "è¯·ç»™æˆ‘å–ä¸€ä¸ª{adjective}çš„{name}åå­—"
)
```

ç„¶åæ¥ä¸‹æ¥åœ¨ä¸¤ä¸ªjupyterçš„cellä¸­åˆ†åˆ«å¡«å…¥ä¸åŒçš„æ¨¡æ¿å‚æ•°

```python
prompt_template.format(adjective="æç¬‘çš„", name="ç”·å­©")
```

ç¨‹åºè¾“å‡ºï¼š

```python
'è¯·ç»™æˆ‘å–ä¸€ä¸ªæç¬‘çš„çš„ç”·å­©åå­—'
```

```python
prompt_template.format(adjective="å¯çˆ±çš„", name="å¥³å­©")
```

ç¨‹åºè¾“å‡ºï¼š

```python
'è¯·ç»™æˆ‘å–ä¸€ä¸ªå¯çˆ±çš„çš„å¥³å­©åå­—'
```

![](../../../assets/img/AIè¿›é˜¶ä¹‹è·¯/å¤§æ¨¡å‹åº”ç”¨å¼€å‘/LangChainä»å…¥é—¨åˆ°ç²¾é€š/Model-IO/image.png)

#### 2.3.2 ä¸å¸¦å‚æ•°

åŒæ ·ï¼Œè¿™ä¸ªæ¨¡æ¿å¯ä»¥åŒ…å«ä»»æ„å¤šä¸ªå˜é‡ï¼Œä¹Ÿå¯ä»¥ä¸åŒ…å«ä»»ä½•å˜é‡

```python
from langchain.prompts import PromptTemplate

prompt_template = PromptTemplate.from_template(
    "è¯·ç»™æˆ‘å–ä¸€ä¸ªåå­—"
)
prompt_template.format()
```

ç¨‹åºè¾“å‡ºï¼š

```python
'è¯·ç»™æˆ‘å–ä¸€ä¸ªåå­—'
```

![](../../../assets/img/AIè¿›é˜¶ä¹‹è·¯/å¤§æ¨¡å‹åº”ç”¨å¼€å‘/LangChainä»å…¥é—¨åˆ°ç²¾é€š/Model-IO/image-1.png)

#### 2.3.3 é€šè¿‡invokeæ–¹æ³•å¡«å…¥æç¤ºè¯å‚æ•°

```python
from langchain.prompts import PromptTemplate

prompt_template = PromptTemplate.from_template(
    "è¯·ç»™æˆ‘å–ä¸€ä¸ª{adjective}çš„{name}åå­—"
)

prompt_template.invoke({"adjective":"å¾ˆåœŸ","name":"ç”·å­©"})
```

ç¨‹åºè¾“å‡º

```python
StringPromptValue(text='è¯·ç»™æˆ‘å–ä¸€ä¸ªå¾ˆåœŸçš„ç”·å­©åå­—')
```

![](../../../assets/img/AIè¿›é˜¶ä¹‹è·¯/å¤§æ¨¡å‹åº”ç”¨å¼€å‘/LangChainä»å…¥é—¨åˆ°ç²¾é€š/Model-IO/image-2.png)

#### 2.3.4 é€šè¿‡åŠ å·å¢åŠ ä¸´æ—¶å†…å®¹

å¦‚æœéœ€è¦åœ¨æ—¢æœ‰çš„æ¨¡æ¿ä¸‹å¢åŠ ä¸´æ—¶å†…å®¹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨+ä¾†å¢åŠ æç¤ºå†…å®¹ã€‚

```python
from langchain.prompts import PromptTemplate

prompt_template = PromptTemplate.from_template(
    "è¯·ç»™æˆ‘å–ä¸€ä¸ª{adjective}çš„{name}åå­—ï¼Œ")+ "å¹¶å‘Šè¯‰æˆ‘ä½ å–åå‚è€ƒçš„æ˜¯{content}"

prompt_template.format(adjective="å¥½å¬çš„",name="ç”·å­©",content="è®ºè¯­")
```

ç¨‹åºè¾“å‡º

```python
'è¯·ç»™æˆ‘å–ä¸€ä¸ªå¥½å¬çš„çš„ç”·å­©åå­—ï¼Œå¹¶å‘Šè¯‰æˆ‘ä½ å–åå‚è€ƒçš„æ˜¯è®ºè¯­'
```

![](../../../assets/img/AIè¿›é˜¶ä¹‹è·¯/å¤§æ¨¡å‹åº”ç”¨å¼€å‘/LangChainä»å…¥é—¨åˆ°ç²¾é€š/Model-IO/image-3.png)

å¯ä»¥çœ‹åˆ°ï¼ŒPromptTemplateå…¶å®å°±æ˜¯èµ·åˆ°ä¸€ä¸ªæ ¼å¼åŒ–è¾“å…¥çš„ä½œç”¨ï¼Œæ¯æ¬¡ä¼šæŠŠæ¨¡æ¿ä¸­çš„å‚æ•°å˜é‡æ›¿æ¢ä¸ºæˆ‘ä»¬çš„çœŸå®è¾“å…¥Language Modelsï¼ˆè¯­è¨€æ¨¡å‹ï¼‰

### 2.4 ChatPromptTemplateï¼ˆå¯¹è¯æç¤ºæ¨¡æ¿ï¼‰

ChatPromptTemplate æ˜¯ä¸“ä¸ºå¤šè½®å¯¹è¯è®¾è®¡çš„æç¤ºæ¨¡æ¿ï¼Œå®ƒå…è®¸å¼€å‘è€…åˆ†åˆ«å®šä¹‰ä¸åŒå¯¹è¯è§’è‰²çš„å†…å®¹ï¼Œä»è€Œå¸®åŠ© AI æ¨¡å‹æ›´è‡ªç„¶åœ°è¿›è¡Œäº¤æµã€‚å®ƒçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯æ¨¡æ‹Ÿå¯¹è¯ä¸­çš„å¤šä¸ªè§’è‰²ï¼ŒåŒ…æ‹¬ç”¨æˆ·è¾“å…¥ï¼ˆHumanMessageï¼‰ã€AI å›å¤ï¼ˆAIMessageï¼‰ï¼Œä»¥åŠç³»ç»Ÿæç¤ºæˆ–èƒŒæ™¯ä¿¡æ¯ï¼ˆSystemMessageï¼‰ã€‚é€šè¿‡è¿™ç§ç»“æ„åŒ–çš„æ–¹å¼ï¼Œå¯ä»¥æå‡å¯¹è¯çš„è¿è´¯æ€§å’ŒçœŸå®æ„Ÿã€‚

ä»£ç ç¤ºä¾‹ï¼š

```python
from langchain_deepseek import ChatDeepSeek
from langchain.prompts.chat import ChatPromptTemplate
import os

load_dotenv()

chat_template = ChatPromptTemplate.from_messages(
    [
        ("system", "ä½ æ˜¯ä¸€ä½ä¸“ä¸šä¸”æœ‰è€å¿ƒçš„å®¢æœåŠ©æ‰‹ï¼Œè´Ÿè´£è§£ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚ä½ çš„åå­—å«{name}."),
        ("human", "ä½ å¥½ï¼Œæˆ‘çš„è®¢å•æ€ä¹ˆè¿˜æ²¡æœ‰å‘è´§ï¼Ÿ"),
        ("ai", "æ‚¨å¥½ï¼Œæˆ‘æ¥å¸®æ‚¨æŸ¥è¯¢ä¸€ä¸‹è®¢å•çŠ¶æ€ï¼Œè¯·æ‚¨ç¨ç­‰ã€‚"),
        ("human", "{user_question}"),
    ]
)

messages = chat_template.format_messages(name="å°æ˜", user_question="è¯·é—®æˆ‘å¯ä»¥ä¿®æ”¹æ”¶è´§åœ°å€å—ï¼Ÿ")

messages

```

ç¨‹åºè¾“å‡ºï¼š

```python
[SystemMessage(content='ä½ æ˜¯ä¸€ä½ä¸“ä¸šä¸”æœ‰è€å¿ƒçš„å®¢æœåŠ©æ‰‹ï¼Œè´Ÿè´£è§£ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚ä½ çš„åå­—å«å°æ˜.', additional_kwargs={}, response_metadata={}),
 HumanMessage(content='ä½ å¥½ï¼Œæˆ‘çš„è®¢å•æ€ä¹ˆè¿˜æ²¡æœ‰å‘è´§ï¼Ÿ', additional_kwargs={}, response_metadata={}),
 AIMessage(content='æ‚¨å¥½ï¼Œæˆ‘æ¥å¸®æ‚¨æŸ¥è¯¢ä¸€ä¸‹è®¢å•çŠ¶æ€ï¼Œè¯·æ‚¨ç¨ç­‰ã€‚', additional_kwargs={}, response_metadata={}),
 HumanMessage(content='è¯·é—®æˆ‘å¯ä»¥ä¿®æ”¹æ”¶è´§åœ°å€å—ï¼Ÿ', additional_kwargs={}, response_metadata={})]
```

![](../../../assets/img/AIè¿›é˜¶ä¹‹è·¯/å¤§æ¨¡å‹åº”ç”¨å¼€å‘/LangChainä»å…¥é—¨åˆ°ç²¾é€š/Model-IO/image-4.png)

å¯ä»¥çœ‹åˆ°ç»è¿‡`format_messages`å‡½æ•°æ ¼å¼åŒ–å¤„ç†åï¼Œæœ€ç»ˆçš„æç¤ºè¯messagesä¸­è¿™ç»„å¯¹è¯å·²ç»å°†æˆ‘ä»¬çš„æœ€ç»ˆè¦ä¼ å…¥çš„å˜é‡"å°æ˜"æ›¿æ¢åˆ°åŸæ¥çš„"name"å‚æ•°å¤„ï¼Œå°†åŸæ¥æ¨¡æ¿ä¸­çš„user\_questionæ›¿æ¢ä¸º"è¯·é—®æˆ‘å¯ä»¥ä¿®æ”¹æ”¶è´§åœ°å€å—ï¼Ÿ"è¿™ä¸ªå­—ç¬¦ä¸²ã€‚æ¥ä¸‹æ¥å†ä¸‹ä¸€ä¸ªcellä¸­è°ƒç”¨DeepDeekå¤§æ¨¡å‹æ¥å£ï¼ŒæŠŠè¿™ä¸ªmessagesä¼ ç»™DeepDeekï¼Œç„¶åçœ‹ä¸‹DeepDeekç»™æˆ‘ä»¬è¿”å›ä»€ä¹ˆï¼Ÿ

```python
from langchain_deepseek import ChatDeepSeek
import os

load_dotenv()

# åˆ›å»º DeepSeek æ¨¡å‹å®ä¾‹
model = ChatDeepSeek(
    model="deepseek-chat",
    temperature=0,
    api_key=os.getenv("DEEPSEEK_API_KEY")
)

# å°†æ¶ˆæ¯å‘é€ç»™æ¨¡å‹
response = model.invoke(messages)

# è¾“å‡ºå“åº”å†…å®¹
print(response.content)
```

ç¨‹åºè¾“å‡º

```python
æ‚¨å¥½ï¼Œå¦‚æœè®¢å•è¿˜æœªå‘è´§ï¼Œæ˜¯å¯ä»¥ä¿®æ”¹æ”¶è´§åœ°å€çš„ã€‚è¯·æ‚¨æä¾›è®¢å•å·ï¼Œæˆ‘å¸®æ‚¨ç¡®è®¤ä¸€ä¸‹å½“å‰çŠ¶æ€ã€‚
```

![](../../../assets/img/AIè¿›é˜¶ä¹‹è·¯/å¤§æ¨¡å‹åº”ç”¨å¼€å‘/LangChainä»å…¥é—¨åˆ°ç²¾é€š/Model-IO/image-5.png)

å°½ç®¡ä¸Šè¿°ä¼ ç»™å¤§æ¨¡å‹çš„æ˜¯ä¸€ç»„å¯¹è¯ï¼Œä½†æ˜¯ç”¨æˆ·æœ€ç»ˆçš„é—®é¢˜&#x662F;**â€œè¯·é—®æˆ‘å¯ä»¥ä¿®æ”¹æ”¶è´§åœ°å€å—ï¼Ÿâ€ï¼Œè€Œè¿™é‡ŒDeepDeekç»™å‡ºçš„å›ç­”æ­£å¥½æ˜¯è¿™ä¸ªé—®é¢˜çš„å›ç­”ï¼Œè€Œä¸”å›ç­”çš„éå¸¸å®Œç¾**

è¿™é‡Œæœ‰ä¸€ä¸ªç–‘é—®ï¼Œæ—¢ç„¶æ˜¯è¦å¤§æ¨¡å‹å›ç­”ç”¨æˆ·çš„å…·ä½“é—®é¢˜ï¼ŒæŒ‰ç…§ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬ç›´æ¥ç»™å¤§æ¨¡å‹æœ€åçš„è¿™ä¸ªé—®é¢˜â€œ**è¯·é—®æˆ‘å¯ä»¥ä¿®æ”¹æ”¶è´§åœ°å€å—ï¼Ÿ**â€ä¸¢ç»™å¤§æ¨¡å‹ä¸å°±å®Œäº†å—ï¼Ÿä¸ºä»€ä¹ˆè¿˜è¦è¿™ä¹ˆåŒ…è£…ä¸€ç»„å¯¹è¯ç»™å®ƒå‘¢ï¼Ÿ

ä»”ç»†æ€è€ƒä¸€ä¸‹ï¼Œå½“ä½ çªç„¶é—®ä¸€ä¸ªäººï¼Œâ€œ**æˆ‘å¯ä»¥ä¿®æ”¹æ”¶è´§åœ°å€å—ï¼Ÿâ€ï¼Œ**&#x5BF9;æ–¹ä¼°è®¡ä¼šä¸€è„¸æ‡µé€¼ï¼Œå•¥ç©æ„ï¼Œçªç„¶æ¥è¿™ä¹ˆä¸ªé—®é¢˜ï¼Œæ˜¯ä¸æ˜¯æé”™æé—®å¯¹è±¡äº†ï¼Ÿ

å¤§æ¨¡å‹åŒæ ·å¦‚æ­¤ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥æŠŠå¤§æ¨¡å‹æƒ³è±¡æˆè¿™ä¸ªäººï¼Œå½“ä½ ä»€ä¹ˆä¸Šä¸‹æ–‡éƒ½æ²¡æä¾›ç»™ä»–çš„æ—¶å€™ï¼Œå°±é—®è¿™ä¹ˆä¸ªé—®é¢˜ï¼Œä»–ä¹Ÿå¾ˆæ‡µé€¼ï¼Œæœ€ååªä¼šç»™ä½ ä¹±è¯´ä¸€é€šã€‚æ‰€ä»¥è¿™é‡Œå†æ¬¡å›åˆ°ChatPromptTemplateæœ¬èº«ï¼Œä»–å…¶å®æ˜¯é€šè¿‡SystemMessageç»™å¤§æ¨¡å‹å®‰ç½®äº†ä¸€ä¸ªèƒŒæ™¯æˆ–è€…äº‹è§’è‰²ï¼Œç„¶åé€šè¿‡å‰é¢çš„å‡ ç»„å¯¹è¯ï¼Œå‘Šè¯‰å¤§æ¨¡å‹ç°åœ¨å¤„åœ¨ä¸€ä¸ªä»€ä¹ˆåœºæ™¯ä¸‹ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥ç”¨æˆ·æçš„é—®é¢˜ï¼Œå¤§æ¨¡å‹æ‰ä¼šæ ¹æ®å®ƒçš„è§’è‰²ï¼ŒåŸºäºå½“å‰åœºæ™¯æ¥å›ç­”ï¼Œ è¿™æ ·çš„å›ç­”æ‰å¯èƒ½æœ€ç»ˆæ˜¯æˆ‘ä»¬æƒ³è¦çš„ç­”æ¡ˆã€‚

ç®€å•æ€»ç»“å°±æ˜¯ï¼Œ**ChatPromptTemplateå¯ä»¥ç»™å¤§æ¨¡å‹çš„å›ç­”æä¾›å¿…è¦çš„ä¸Šä¸‹æ–‡ï¼Œä½¿å¾—å¤§æ¨¡å‹çš„å›ç­”å‡†ç¡®æ€§æ›´é«˜äº†**

å½“ç„¶ï¼ŒLangChainæ¡†æ¶ä¸çŸ¥æä¾›äº†è¿™ä¸¤ç§æç¤ºè¯æ¨¡æ¿ï¼Œè¿˜æœ‰MessagePromptï¼ŒPipelinePromptç­‰ä¸€äº›åˆ—çš„promptæ¨¡æ¿ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€ä»‹ç»äº†ï¼Œåç»­æœ‰ç”¨åˆ°çš„æ—¶å€™å¯ä»¥å»å®˜æ–¹çš„APIæ–‡æ¡£æŸ¥çœ‹å…·ä½“ç”¨æ³•ï¼šhttps://python.langchain.com/v0.1/docs/modules/model\_io/prompts/quick\_start/

## 3. **Language Model**

åœ¨ LangChain ä¸­ï¼Œ**Language Model æ¨¡å—**æ˜¯ç”¨äºç›´æ¥ä¸è¯­è¨€æ¨¡å‹è¿›è¡Œäº¤äº’çš„æ ¸å¿ƒæ„å»ºå•å…ƒï¼ˆBuilding Blockï¼‰ã€‚

ç›®å‰ï¼ŒLangChain ä¸»è¦æ”¯æŒå¹¶é›†æˆäº†ä¸¤ç±»è¯­è¨€æ¨¡å‹ï¼š

* **LLMs**ï¼šæ¥å—æ–‡æœ¬å­—ç¬¦ä¸²ä½œä¸ºè¾“å…¥ï¼Œè¿”å›æ–‡æœ¬å­—ç¬¦ä¸²ä½œä¸ºè¾“å‡ºçš„æ¨¡å‹ï¼ˆå³ *text in â†’ text out*ï¼‰ã€‚

* **Chat Models**ï¼šä»¥ä¸€ç»„å¯¹è¯æ¶ˆæ¯ä½œä¸ºè¾“å…¥ï¼Œè¿”å›æ–°çš„å¯¹è¯æ¶ˆæ¯ä½œä¸ºè¾“å‡ºçš„æ¨¡å‹ï¼ˆå³ *chat messages in â†’ chat messages out*ï¼‰ã€‚è¿™äº›æ¶ˆæ¯é€šå¸¸åŒ…å«æ–‡æœ¬å†…å®¹ï¼ˆcontentï¼‰å’Œè§’è‰²ï¼ˆroleï¼‰ä¿¡æ¯ï¼ˆå¦‚ *systemã€humanã€ai*ï¼‰ã€‚

ç®€å•ç†è§£å°±æ˜¯ï¼ŒLMå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªæ–‡æœ¬ç”Ÿæˆå¼æ¨¡å‹ï¼Œå³å¤§æ¨¡å‹ä¼šæ ¹æ®ç”¨æˆ·è¾“å…¥çš„æŒ‡ç¤ºï¼Œç”Ÿæˆä¸€æ®µç›¸å…³çš„æ–‡æœ¬ï¼›

è€ŒChat Modelåˆ™æ˜¯ä¸€ä¸ªèŠå¤©é©±åŠ¨çš„æ¨¡å‹ï¼Œå³å¯ä»¥è¿›è¡Œå¤šè½®å¯¹è¯ã€‚

### 3.1 **LLMs**

LLM æ˜¯ LangChain æ¶æ„ä¸­çš„å…³é”®ç»„æˆéƒ¨åˆ†ï¼Œä¹Ÿå«Base LLMã€‚å…¸å‹çš„äº¤äº’æ¨¡å¼æ˜¯ï¼š**æ–‡æœ¬è¾“å…¥ â†’ æ–‡æœ¬è¾“å‡ºï¼ˆ text in â†’ text outï¼‰**ã€‚LangChain æä¾›äº†ç»Ÿä¸€çš„æ ‡å‡†æ¥å£ï¼Œç”¨äºå¯¹æ¥å¤šç§ LLM ç±»å‹ã€‚ä½ å¯ä»¥åœ¨å…¶æ–‡æ¡£ä¸­æŸ¥çœ‹å½“å‰æ”¯æŒçš„å„ç±»æ¨¡å‹ã€‚

æ‰€æœ‰ LLM å®ç°éƒ½éµå¾ª LangChain çš„ **Runnable æ¥å£è§„èŒƒ**ï¼Œè¯¥æ¥å£æä¾›äº†å¦‚ `invoke`ã€`ainvoke`ã€`batch`ã€`abatch`ã€`stream`ã€`astream` ç­‰æ–¹æ³•çš„é»˜è®¤å®ç°ï¼Œæ–¹ä¾¿å¼€å‘è€…çµæ´»è°ƒç”¨æ¨¡å‹ã€‚

> è¿™é‡Œçš„LLM  Modelæˆ‘ä»¬ä½¿ç”¨çš„å¤§æ¨¡å‹æ˜¯å›½å†…é˜¿é‡Œçš„é€šä¹‰åƒé—®ï¼Œå› ä¸ºDeepSeekå¹¶æ²¡æœ‰åœ¨LangChainä¸­å³æˆåŸºç¡€Model LLMï¼Œè€Œæ˜¯è¦é€šè¿‡Ollamaå»è°ƒç”¨ï¼Œè¿™é‡Œæˆ‘ä»¬åç»­å†åšä»‹ç»ã€‚
>
> åŒæ ·æˆ‘ä»¬é¦–å…ˆéœ€è¦åˆ°é€šä¹‰åƒé—®åˆ›å»ºä¸€ä¸ªAPI Keyï¼Œhttps://bailian.console.aliyun.com/?apiKey=1#/api-key

åŒç†ï¼Œåœ¨åˆ›å»ºå®ŒAPI Keyä¹‹åï¼Œéœ€è¦æŠŠå®ƒäº›å…¥åˆ°é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„.envæ–‡ä»¶ä¸­ï¼Œæ–¹ä¾¿åç»­åœ¨é¡¹ç›®ä¸­åŠ è½½

```plain&#x20;text
DASHSCOPE_API_KEY=sk-45e155e83f524602b19b7c67e45932  // è¿™é‡Œæ›¿æ¢ä¸ºè‡ªå·±çš„API Key
```

ä»£ç ç¤ºä¾‹ï¼š

```python
from langchain_community.llms import Tongyi
from dotenv import load_dotenv
# å¯¼å…¥æ“ä½œç³»ç»Ÿç›¸å…³åŠŸèƒ½
import os

# åŠ è½½ .env æ–‡ä»¶ä¸­çš„ç¯å¢ƒå˜é‡
load_dotenv()

dashscope_api_key = os.getenv("DASHSCOPE_API_KEY")

# api keyä½œä¸ºå‚æ•°ä¼ å…¥
llm = Tongyi(
    model="qwen-turbo",  # æˆ–å…¶ä»–æ¨¡å‹ï¼Œå¦‚"qwen-plus", "qwen-max"
    dashscope_api_key=dashscope_api_key,
    temperature=0
)

response = llm.invoke("å››å¤§åè‘—æŒ‡çš„æ˜¯ä»€ä¹ˆ?")

print(response)
```

ç¨‹åºè¾“å‡º

```markdown
å››å¤§åè‘—æ˜¯ä¸­å›½å¤ä»£æ–‡å­¦çš„ç‘°å®ï¼Œé€šå¸¸æŒ‡ä»¥ä¸‹å››éƒ¨ç»å…¸è‘—ä½œï¼š

1. **ã€Šçº¢æ¥¼æ¢¦ã€‹**ï¼šä½œè€…æ›¹é›ªèŠ¹ï¼Œè¢«èª‰ä¸ºä¸­å›½å¤å…¸å°è¯´çš„å·…å³°ä¹‹ä½œã€‚å°è¯´ä»¥è´¾å®ç‰å’Œæ—é»›ç‰çš„çˆ±æƒ…æ‚²å‰§ä¸ºä¸»çº¿ï¼Œæç»˜äº†å°å»ºè´µæ—å®¶åº­çš„å…´è¡°å’Œç¤¾ä¼šçš„å¤æ‚äººé™…å…³ç³»ã€‚

2. **ã€Šè¥¿æ¸¸è®°ã€‹**ï¼šä½œè€…å´æ‰¿æ©ï¼Œæ˜¯ä¸€éƒ¨ç¥é­”å°è¯´ã€‚è®²è¿°äº†å”åƒ§å¸ˆå¾’å››äººå–ç»çš„å†é™©æ•…äº‹ï¼Œå……æ»¡äº†å¥‡å¹»è‰²å½©å’Œæ·±åˆ»çš„å“²ç†æ€è€ƒã€‚

3. **ã€Šä¸‰å›½æ¼”ä¹‰ã€‹**ï¼šä½œè€…ç½—è´¯ä¸­ï¼Œæ˜¯ä¸€éƒ¨å†å²æ¼”ä¹‰å°è¯´ã€‚ä»¥ä¸œæ±‰æœ«å¹´åˆ°ä¸‰å›½æ—¶æœŸçš„å†å²ä¸ºèƒŒæ™¯ï¼Œæå†™äº†é­ã€èœ€ã€å´ä¸‰å›½ä¹‹é—´çš„æ”¿æ²»æ–—äº‰å’Œå†›äº‹å†²çªã€‚

4. **ã€Šæ°´æµ’ä¼ ã€‹**ï¼šä½œè€…æ–½è€åºµï¼Œæ˜¯ä¸€éƒ¨æå†™å†œæ°‘èµ·ä¹‰çš„å°è¯´ã€‚è®²è¿°äº†æ¢å±±å¥½æ±‰åæŠ—è…è´¥å®˜åºœçš„æ•…äº‹ï¼Œå±•ç°äº†æ±Ÿæ¹–è±ªæƒ…å’Œè‹±é›„æ°”æ¦‚ã€‚

è¿™å››éƒ¨ä½œå“ä¸ä»…åœ¨ä¸­å›½æ–‡å­¦å²ä¸Šå æœ‰é‡è¦åœ°ä½ï¼Œä¹Ÿå¯¹åä¸–çš„æ–‡åŒ–å’Œè‰ºæœ¯äº§ç”Ÿäº†æ·±è¿œçš„å½±å“ã€‚
```

### 3.2 Chat Model

Chat Modelå¯ä»¥è®¤ä¸ºæ˜¯LLM çš„å˜ä½“ï¼Œå…¶åº•å±‚é€šå¸¸è¿˜æ˜¯ç”±Base LLMæ”¯æ’‘ï¼Œä½†ä¸“é—¨é’ˆå¯¹å¯¹è¯è¿›è¡Œäº†è°ƒæ•´ã€‚å¹¶ä¸”å®ƒæä¾›çš„ Interface æœ‰äº†æ¯”è¾ƒå¤§çš„å·®å¼‚ï¼Œæä¾›åŸºäº"èŠå¤©æ¶ˆæ¯"çš„æ¥å£ï¼Œè€Œä¸å•å•æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ä»–çš„è¾“å…¥å’Œè¾“å‡ºå¯ä»¥ç®€å•ç†è§£å¦‚ä¸‹ï¼š

| è¾“å…¥     | è¾“å‡º     |
| ------ | ------ |
| ä¸€ç»„èŠå¤©æ¶ˆæ¯ | ä¸€æ¡èŠå¤©æ¶ˆæ¯ |

#### 3.2.1 Messagesç±»å‹

Chat modelsä½¿ç”¨chat messageä½œä¸ºè¾“å…¥å’Œè¾“å‡ºï¼ŒLangChainç›®å‰æ”¯æŒçš„`chat message`ç±»å‹æœ‰ï¼š

| Messagesç±»å‹      | ç”¨é€”                                                                                                    |
| --------------- | ----------------------------------------------------------------------------------------------------- |
| SystemMessage   | è®¾å®šå¤§æ¨¡å‹çš„èº«ä»½ï¼Œäººè®¾                                                                                           |
| HumanMessage    | ç”¨æˆ·è¾“å…¥                                                                                                  |
| AIMessage       | æ¨¡å‹è¾“å‡º                                                                                                  |
| FunctionMessage | å‡½æ•°è°ƒç”¨çš„è¿”å›ç»“æœï¼Œç”¨äºæ ‡è¯†æŸä¸ªå‡½æ•°æ‰§è¡Œçš„å†…å®¹è¿”å›ï¼Œé™¤äº†å¯¹åº”çš„`role`å’Œ`content`å‚æ•°å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ª`name`å‚æ•°ï¼Œè¡¨ç¤ºå¯¹åº”åç§°çš„å‡½æ•°çš„æ‰§è¡Œç»“æœï¼Œä¸ `function_call` æ­é…ä½¿ç”¨ |
| ToolMessage     | å·¥å…·è°ƒç”¨çš„è¿”å›ç»“æœï¼Œç”¨äºæ ‡è¯†æŸä¸ªå·¥å…·æ‰§è¡Œçš„å†…å®¹è¿”å›ï¼Œ`tool_call_id`ï¼šè¡¨ç¤ºå¯¹åº”å“ªä¸€æ¬¡å·¥å…·è°ƒç”¨çš„è¿”å›ç»“æœï¼Œä¸ `tool_calls` æ­é…                           |

è¿™é‡Œä¸»è¦è®²è§£å‰é¢ä¸‰ç§Messagesç±»å‹ï¼Œå‡½æ•°å’Œå·¥å…·çš„è°ƒç”¨å°±ä¸åœ¨è¿™é‡Œæ¼”ç¤ºäº†ï¼Œåç»­ç« èŠ‚ä¼šä¸“é—¨è®²è§£

ä»£ç ç¤ºä¾‹ï¼š

```python
from langchain_deepseek import ChatDeepSeek
import os

load_dotenv()

# åˆ›å»º DeepSeek æ¨¡å‹å®ä¾‹
model = ChatDeepSeek(
    model="deepseek-chat",
    temperature=0,
    api_key=os.getenv("DEEPSEEK_API_KEY")
)

messages = [
    SystemMessage(content="ä½ ä¸€åä¸­å›½å¤è¯—è¯é‰´èµä¸“å®¶"),
    HumanMessage(content="ã€Šé’ç‰æ¡ˆÂ·å…ƒå¤•ã€‹"),
]

response = model.invoke(messages)

print(response.content)

```

ç¨‹åºè¾“å‡º

```python
ã€Šé’ç‰æ¡ˆÂ·å…ƒå¤•ã€‹
ä¸œé£å¤œæ”¾èŠ±åƒæ ‘ï¼Œæ›´å¹è½ã€æ˜Ÿå¦‚é›¨ã€‚
å®é©¬é›•è½¦é¦™æ»¡è·¯ã€‚
å‡¤ç®«å£°åŠ¨ï¼Œç‰å£¶å…‰è½¬ï¼Œä¸€å¤œé±¼é¾™èˆã€‚
è›¾å„¿é›ªæŸ³é»„é‡‘ç¼•ï¼Œç¬‘è¯­ç›ˆç›ˆæš—é¦™å»ã€‚
ä¼—é‡Œå¯»ä»–åƒç™¾åº¦ï¼Œè“¦ç„¶å›é¦–ï¼Œé‚£äººå´åœ¨ï¼Œç¯ç«é˜‘çŠå¤„ã€‚

èµæï¼šè¿™é¦–ä½œå“æç»˜äº†å…ƒå®µå¤œçš„çƒ­é—¹åœºæ™¯ï¼Œé€šè¿‡â€œèŠ±åƒæ ‘â€ã€â€œæ˜Ÿå¦‚é›¨â€ç­‰æ„è±¡å±•ç°äº†èŠ‚æ—¥çš„ç’€ç’¨ä¸ç¹åã€‚ä¸‹é˜•åˆ™ç¬”é”‹ä¸€è½¬ï¼Œå†™åˆ°äº†åœ¨äººç¾¤ä¸­å¯»æ‰¾å¿ƒä¸Šäººçš„æƒ…æ™¯ï¼Œæœ€ç»ˆåœ¨â€œç¯ç«é˜‘çŠå¤„â€æ‰¾åˆ°äº†å¥¹ï¼Œè¡¨è¾¾äº†åœ¨å–§åš£ä¸­å¯»æ‰¾å†…å¿ƒå®é™ä¸çœŸçˆ±çš„æƒ…æ„Ÿã€‚æ•´é¦–è¯è¯­è¨€ä¼˜ç¾ï¼Œæ„å¢ƒæ·±è¿œï¼Œæƒ…æ„ŸçœŸæŒšåŠ¨äººã€‚
```

![](../../../assets/img/AIè¿›é˜¶ä¹‹è·¯/å¤§æ¨¡å‹åº”ç”¨å¼€å‘/LangChainä»å…¥é—¨åˆ°ç²¾é€š/Model-IO/image-6.png)

ä¸Šè¿°ä¾‹å­çŸ¥è¯†ç”¨SystemMessageç»™äº†AIä¸€ä¸ªèº«ä»½ï¼Œå¹¶ä¸”è®©å…¶å›ç­”HumanMessageä¸­ç”¨æˆ·çš„é—®é¢˜ï¼Œå¾ˆç®€å•ã€‚æ—¢ç„¶å­¦ä¹ äº†å‰é¢çš„æç¤ºè¯æ¨¡æ¿ï¼Œè¿™é‡ŒåŒæ ·å¯ä»¥ç”¨æ¨¡æ¿æ¥ç»™è¿™å‡ ä¸ªmessageè¿›è¡Œæ ¼å¼åŒ–ï¼Œè¯·çœ‹ä¸‹é¢çš„ä¾‹å­

```python
from langchain_deepseek import ChatDeepSeek
import os

from langchain.chat_models import ChatOpenAI
from langchain.prompts.chat import (
    ChatPromptTemplate,
    SystemMessagePromptTemplate,
    HumanMessagePromptTemplate
)

load_dotenv()

# åˆ›å»º DeepSeek æ¨¡å‹å®ä¾‹
model = ChatDeepSeek(
    model="deepseek-chat",
    temperature=0,
    api_key=os.getenv("DEEPSEEK_API_KEY")
)

# âœ… æ„å»º Prompt æ¨¡æ¿ï¼ˆå¸¦å˜é‡ï¼‰
system_template = "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ {role}ï¼Œå›ç­”é—®é¢˜è¦ç®€æ´æ¸…æ™°ã€‚"
human_template = "è¯·ç”¨ {language} å†™ä¸€ä¸ª {task} çš„ç¨‹åºã€‚"

# âœ… ä½¿ç”¨æ¨¡æ¿å°è£… message
system_message_prompt = SystemMessagePromptTemplate.from_template(system_template)
human_message_prompt = HumanMessagePromptTemplate.from_template(human_template)

# âœ… æ„å»ºæœ€ç»ˆ ChatPromptTemplate
chat_prompt = ChatPromptTemplate.from_messages([
    system_message_prompt,
    human_message_prompt
])

# âœ… æ¨¡æ¿å¡«å……å˜é‡
formatted_messages = chat_prompt.format_messages(
    role="åç«¯å¼€å‘ä¸“å®¶",
    language="Goè¯­è¨€",
    task="å¿«é€Ÿæ’åº"
)

response = model.invoke(formatted_messages)

print(response.content)
```

ç¨‹åºè¾“å‡º

```python
[SystemMessage(content='ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ åç«¯å¼€å‘ä¸“å®¶ï¼Œå›ç­”é—®é¢˜è¦ç®€æ´æ¸…æ™°ã€‚', additional_kwargs={}, response_metadata={}),
 HumanMessage(content='è¯·ç”¨ Goè¯­è¨€ å†™ä¸€ä¸ª å¿«é€Ÿæ’åº çš„ç¨‹åºã€‚', additional_kwargs={}, response_metadata={})]
```

å¯ä»¥çœ‹åˆ°æœ€ç»ˆå°†`chat_prompt`å˜æˆäº†`list`çš„å½¢å¼ï¼Œå¹¶ä¸”è®²åŸæ¥messageé‡Œçš„æ¨¡æ¿å‚æ•°æ›¿æ¢æˆäº†çœŸæ­£çš„å˜é‡ã€‚

ç„¶åæˆ‘ä»¬æŠŠ`chat_prompt`ä½œä¸ºè¾“å…¥ï¼Œè°ƒç”¨DeepSeekæ¥å£ï¼Œçœ‹ä¸€ä¸‹è¿”å›ç»“æœï¼š

````sql
ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Go è¯­è¨€å®ç°çš„å¿«é€Ÿæ’åºç¨‹åºï¼š

```go
package main

import "fmt"

func quickSort(arr []int) []int {
    if len(arr) <= 1 {
        return arr
    }

    pivot := arr[0]
    var left, right []int

    for _, v := range arr[1:] {
        if v <= pivot {
            left = append(left, v)
        } else {
            right = append(right, v)
        }
    }

    left = quickSort(left)
    right = quickSort(right)

    return append(append(left, pivot), right...)
}

func main() {
    arr := []int{3, 6, 8, 10, 1, 2, 1}
    fmt.Println("Original array:", arr)
    sortedArr := quickSort(arr)
    fmt.Println("Sorted array:", sortedArr)
}
```

### ä»£ç è¯´æ˜ï¼š
1. **quickSort å‡½æ•°**ï¼šé€’å½’åœ°å¯¹æ•°ç»„è¿›è¡Œæ’åºã€‚
   - å¦‚æœæ•°ç»„é•¿åº¦å°äºç­‰äº 1ï¼Œç›´æ¥è¿”å›æ•°ç»„ã€‚
   - é€‰æ‹©æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä½œä¸ºåŸºå‡†ï¼ˆpivotï¼‰ã€‚
   - å°†æ•°ç»„åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šå°äºç­‰äºåŸºå‡†çš„éƒ¨åˆ†å’Œå¤§äºåŸºå‡†çš„éƒ¨åˆ†ã€‚
   - é€’å½’åœ°å¯¹å·¦å³ä¸¤éƒ¨åˆ†è¿›è¡Œæ’åºï¼Œæœ€ååˆå¹¶ç»“æœã€‚

2. **main å‡½æ•°**ï¼šæµ‹è¯•å¿«é€Ÿæ’åºç®—æ³•ã€‚
   - å®šä¹‰ä¸€ä¸ªæœªæ’åºçš„æ•°ç»„ã€‚
   - è°ƒç”¨ `quickSort` å‡½æ•°è¿›è¡Œæ’åºï¼Œå¹¶è¾“å‡ºç»“æœã€‚

### è¾“å‡ºç¤ºä¾‹ï¼š
```
Original array: [3 6 8 10 1 2 1]
Sorted array: [1 1 2 3 6 8 10]
```

è¿™ä¸ªç¨‹åºå®ç°äº†å¿«é€Ÿæ’åºçš„åŸºæœ¬é€»è¾‘ï¼Œé€‚ç”¨äºå¤§å¤šæ•°æƒ…å†µã€‚
````

DeepSeekä¸ä»…å¸®æˆ‘ä»¬å†™å¥½äº†ç¨‹åºï¼Œè¿˜ç»™å‡ºæ¥ä»£ç æ°´åå’Œæµ‹è¯•ç”¨ä¾‹ï¼Œéå¸¸å®Œç¾

## 4. **Output Parsers**

Output Parsers å³è¾“å‡ºè§£æå™¨ï¼Œä»å‰é¢ç¤ºä¾‹å¯ä»¥çœ‹åˆ°ï¼Œ`LLM`å’Œ`ChatModel`çš„è¾“å‡ºéƒ½æ˜¯è‡ªç„¶è¯­è¨€æ–‡æœ¬ï¼Œä¹Ÿå°±æ˜¯å­—ç¬¦ä¸² ã€‚ä½†å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›å®ƒèƒ½ä»¥ç‰¹å®šçš„æ ¼å¼è¾“å‡ºï¼Œä»¥ä¾¿è§£ææˆç»“æ„åŒ–çš„æ•°æ®ã€‚LangChainä¹Ÿæä¾›çš„Output Parserså°±æ˜¯å®Œæˆè¿™ä¸ªåŠŸèƒ½çš„

Output Parsers åœ¨ä½¿ç”¨çš„æ—¶å€™é€šå¸¸éœ€è¦å®ç°ä¸¤ä¸ªå…³é”®æ–¹æ³•ï¼š

1. **`get_format_instructions()`**ï¼šè¿”å›ä¸€æ®µæ–‡æœ¬ï¼Œç”¨äºå‘Šè¯‰è¯­è¨€æ¨¡å‹å¦‚ä½•ç»„ç»‡å’Œæ ¼å¼åŒ–å®ƒçš„è¾“å‡ºå†…å®¹ã€‚

2. **`parse()`**ï¼šç”¨äºæ¥æ”¶è¯­è¨€æ¨¡å‹è¿”å›çš„å­—ç¬¦ä¸²ç»“æœï¼Œå¹¶å°†å…¶è§£æä¸ºç»“æ„åŒ–çš„æ•°æ®å½¢å¼ï¼ˆå¦‚å­—å…¸ã€å¯¹è±¡ç­‰ï¼‰ï¼Œä¾¿äºåç»­ç¨‹åºå¤„ç†ã€‚

ç›®å‰LangChainæä¾›äº†ä¸€äº›åˆ—é¢„å®šä¹‰çš„ç±»ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„é¢„å®šä¹‰çš„ Output Parsers

è¿™é‡Œä»¥**CommaSeparatedListOutputParser**ä¸ºä»£ç ç¤ºä¾‹çœ‹ä¸€ä¸‹Output Parsersçš„å…·ä½“ç”¨æ³• ï¼š

```python
# å¯¼å…¥é€—å·åˆ†éš”è¾“å‡ºè§£æå™¨
from langchain.output_parsers import CommaSeparatedListOutputParser
# å¯¼å…¥èŠå¤©æç¤ºæ¨¡æ¿  
from langchain.prompts import ChatPromptTemplate  
# å¯¼å…¥ DeepSeek æ¨¡å‹è°ƒç”¨æ¨¡å—                  
from langchain_deepseek import ChatDeepSeek 
# å¯¼å…¥ osï¼Œç”¨äºè¯»å– API Key ç¯å¢ƒå˜é‡                         
import os                                                            

# 1ï¸âƒ£ åˆ›å»ºæç¤ºè¯æ¨¡æ¿ï¼ŒåŒ…å« system å’Œ human ä¸¤ç§æ¶ˆæ¯è§’è‰²
prompt = ChatPromptTemplate.from_messages([
    ("system", "{parser_instructions}"),  # system roleï¼šè¿™é‡Œçš„ç³»ç»ŸèƒŒæ™¯è¦ç´ æ¨¡å‹ï¼Œè¦è®¾ç½®æ¨¡å‹è¾“å‡ºæ ¼å¼è§„èŒƒï¼Œ
    ("human", "åˆ—å‡º{cityName}çš„{viewPointNum}ä¸ªè‘—åæ™¯ç‚¹ã€‚")  # human roleï¼šå®é™…ä»»åŠ¡æŒ‡ä»¤ï¼ˆç”¨æˆ·é—®é¢˜ï¼‰
])

# 2ï¸âƒ£ ä½¿ç”¨ CommaSeparatedListOutputParser ä½œä¸º
output_parser = CommaSeparatedListOutputParser()

# 3ï¸âƒ£ è·å–è¾“å‡ºè§£æå™¨æä¾›çš„æ ¼å¼æŒ‡å¯¼è¯´æ˜æ–‡æœ¬
parser_instructions = output_parser.get_format_instructions()
# ğŸ‘‰ æ‰“å°æŸ¥çœ‹æ ¼å¼è¯´æ˜ï¼šå‘Šè¯‰æ¨¡å‹â€œè¯·ä»¥é€—å·åˆ†éš”çš„å½¢å¼è¾“å‡ºç»“æœâ€
print(parser_instructions)

# 4ï¸âƒ£ æ„é€ æœ€ç»ˆçš„ promptï¼Œå°†æ¨¡æ¿å˜é‡å¡«å……å®Œæ•´
final_prompt = prompt.invoke({
    "cityName": "å—äº¬",                       # è®¾ç½®åŸå¸‚åå˜é‡
    "viewPointNum": 5,                        # è®¾ç½®æ™¯ç‚¹æ•°é‡
    "parser_instructions": parser_instructions  # å¡«å……æ ¼å¼æŒ‡ä»¤ï¼Œç³»ç»Ÿè§’è‰²çš„å†…å®¹
})

# 5ï¸âƒ£ åˆ›å»º DeepSeek æ¨¡å‹å®ä¾‹
model = ChatDeepSeek(
    model="deepseek-chat",                    # æ¨¡å‹åç§°
    temperature=0,                            # æ§åˆ¶è¾“å‡ºç¨³å®šæ€§ï¼ˆ0 è¡¨ç¤ºç¡®å®šæ€§æ›´å¼ºï¼‰
    api_key=os.getenv("DEEPSEEK_API_KEY")     # ä»ç¯å¢ƒå˜é‡è¯»å– API Key
)

# 6ï¸âƒ£ è°ƒç”¨æ¨¡å‹ï¼Œè·å–æ¨¡å‹å“åº”å†…å®¹
response = model.invoke(final_prompt)

# 7ï¸âƒ£ ä½¿ç”¨è§£æå™¨å°†æ¨¡å‹è¾“å‡ºå†…å®¹è½¬æ¢æˆ Python åˆ—è¡¨
ret = output_parser.invoke(response)

# 8ï¸âƒ£ è¾“å‡ºæœ€ç»ˆè§£æç»“æœ
print(ret)  # ç¤ºä¾‹è¾“å‡ºï¼š['ä¸­å±±é™µ', 'å¤«å­åº™', 'å—äº¬é•¿æ±Ÿå¤§æ¡¥', 'ç„æ­¦æ¹–', 'æ€»ç»Ÿåºœ']

```

ç¨‹åºè¾“å‡ºï¼š

```javascript
Your response should be a list of comma separated values, eg: `foo, bar, baz` or `foo,bar,baz`
['ä¸­å±±é™µ', 'å¤«å­åº™', 'æ˜å­é™µ', 'ç„æ­¦æ¹–', 'å—äº¬åšç‰©é™¢']
```

![](../../../assets/img/AIè¿›é˜¶ä¹‹è·¯/å¤§æ¨¡å‹åº”ç”¨å¼€å‘/LangChainä»å…¥é—¨åˆ°ç²¾é€š/Model-IO/image-7.png)

## 5. å°ç»“

Model I/Oæ¨¡å—æ˜¯LangChain æ¡†æ¶çš„æ ¸å¿ƒæ¨¡å—ï¼Œå®ƒä¸»è¦ç”± Prompt Template æ¨¡å—ã€è¯­è¨€æ¨¡å‹ï¼ˆLLM ä¸ Chat Modelï¼‰ã€è¾“å‡ºè§£æå™¨ï¼ˆOutput Parsersï¼‰ä¸‰å¤§æ ¸å¿ƒç»„ä»¶æ„æˆã€‚Prompt ä½œä¸ºä¸æ¨¡å‹äº¤äº’çš„â€œæ¡¥æ¢â€ï¼Œåœ¨æé«˜æŒ‡ä»¤æ¸…æ™°åº¦å’Œä»»åŠ¡è¡¨è¾¾åŠ›æ–¹é¢å‘æŒ¥ç€é‡è¦ä½œç”¨ï¼›LLM å’Œ Chat Model åˆ™æ„æˆäº†æ•´ä¸ªæ¨¡å‹è°ƒç”¨é“¾çš„æ‰§è¡Œæ ¸å¿ƒï¼›è€Œ Output Parsers åˆ™å¸®åŠ©æˆ‘ä»¬æå‡æ¨¡å‹ç»“æœçš„å¯æ§æ€§å’Œå¯è§£ææ€§ã€‚

